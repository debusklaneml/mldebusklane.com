---
title: "TidyTuesday - Beer Production - 2020 - Wk 10"
author: admin
date: '2020-04-07'
slug:  
categories: [Code]
tags:
  - R
  - TidyTuesday
subtitle: ''  
summary: 'A look at beer production'
authors: [M. L. DeBusk-Lane]
lastmod: '2020-04-07T07:57:09-05:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
output: 
  html_document:
    theme: journal
    highlight: zenburn

---
```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = TRUE, warning = FALSE, message = FALSE, 
                      echo = TRUE, dpi = 300, cache.lazy = FALSE,
                      fig.width = 8, fig.height = 7)
```

This week's effort will dive into beer production across America. You may find more informaiton at [Alcohol and Tobacco Tax and Trade Bureau (TTB)](https://www.ttb.gov/beer/statistics). 

```{r}
library(tidyverse)
library(janitor)
library(readxl)
library(tidylog)
library(ggdark)
library(ggforce)
library(rvest)
library(glue)
library(patchwork)
library(stringi)
library(lubridate)

# Read in the data. 
brewing_materials <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-31/brewing_materials.csv')
beer_taxed <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-31/beer_taxed.csv')
brewer_size <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-31/brewer_size.csv')
beer_states <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-31/beer_states.csv')

```


```{r}
hops <- brewing_materials %>%
  filter(between(year, 2008, 2015)) %>%
  mutate(date = make_date(year, month)) %>%
  group_by(date, type) %>%
  summarize(avg = mean(month_current)) %>%
  filter(!type %in% c('Total Grain products', 'Other', 'Total Non-Grain products', 'Total Used')) 
```


I like IPAs, so lets see if we can see the obvious rise in the market through what materials are used to make it. 

According to 
```{r}
time_series <- hops %>%
  ggplot(aes(x = date, y = avg, group = type)) + 
  geom_line(aes(color = type)) + 
  theme(axis.text.x = element_text(angle = 90))
time_series
```

I wanted to becone a bit more familiar with plotly... primarily because I wanted to use it to eventually make some flexdashboard stuff. 

```{r}
library(plotly) 
# Need to widen the data. 
hops.w = hops %>% ungroup() %>% 
  pivot_wider(names_from = type, values_from = avg) %>% clean_names()
fig <- plot_ly(hops.w, x = ~date, y = ~hops_dry, name = 'dry hops', type = 'scatter', mode = 'lines',
               line = list(color = 'red', width = 2))
fig <- fig %>% add_trace(y = ~sugar_and_syrups, name = 'Barley Products', type = 'scatter',mode = 'lines+markers',
                         line = list(color = 'blue', width = 2))
fig <- fig %>% layout(title = "Materials Use Over Time",
         xaxis = list(title = "Date"),
         yaxis = list (title = "Usage"))
fig
```


```{r, fig.height= 10, fig.width= 10}

```

