---
title: "TidyTuesday - Beer Production - 2020 - Wk 10"
author: admin
date: '2020-04-07'
slug:  
categories: [Code]
tags:
  - R
  - TidyTuesday
subtitle: ''  
summary: 'A look at beer production'
authors: [M. L. DeBusk-Lane]
lastmod: '2020-04-07T07:57:09-05:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
output: 
  html_document:
    theme: journal
    highlight: zenburn

---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/plotly-binding/plotly.js"></script>
<script src="/rmarkdown-libs/typedarray/typedarray.min.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<link href="/rmarkdown-libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/rmarkdown-libs/plotly-main/plotly-latest.min.js"></script>


<p>This week’s effort will dive into beer production across America. You may find more informaiton at <a href="https://www.ttb.gov/beer/statistics">Alcohol and Tobacco Tax and Trade Bureau (TTB)</a>.</p>
<p>This EDA and time series analysis is not for quality, validity, or in line with typical time series analysis practice. I’m simply messing around with both the <code>TSstudio</code> and <code>forecastLM</code> packages… just to give them some love.</p>
<pre class="r"><code>library(tidyverse)
library(janitor)
library(lubridate)
library(plotly)

# Read in the data. 
brewing_materials &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-31/brewing_materials.csv&#39;)
beer_taxed &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-31/beer_taxed.csv&#39;)
brewer_size &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-31/brewer_size.csv&#39;)
beer_states &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-31/beer_states.csv&#39;)</code></pre>
<p>Let’s begin with a bit of data prep. I’m most interested in how this looks longitudinally, so I used <code>make_date</code> to bring together the year and month into a date variable–primarily for proper sorting.</p>
<pre class="r"><code>hops1 &lt;- brewing_materials %&gt;%
  mutate(date = make_date(year, month)) %&gt;%
  group_by(date, type) %&gt;%
  summarize(avg = mean(month_current)) %&gt;%
  filter(!type %in% c(&#39;Total Grain products&#39;, &#39;Other&#39;, &#39;Total Non-Grain products&#39;, &#39;Total Used&#39;)) </code></pre>
<pre class="r"><code>time_series1 &lt;- hops1 %&gt;%
  ggplot(aes(x = date, y = avg, group = type)) + 
  geom_line(aes(color = type)) + 
  theme(axis.text.x = element_text(angle = 90))
time_series1</code></pre>
<p><img src="/post/TidyTuesday/tt_2020_w14_beer_files/figure-html/unnamed-chunk-3-1.png" width="768" /></p>
<p>Clearly something does not look right after 2016. From what I can find, it appears they changed the reporting criteria or structure. Although I was looking for some type of diverging trend to indicate a change in types of beer popularity (my hypothesis), I’m not sure that is evident. The <code>Hops (dry)</code> variable obviously does something crazy in 2015-2016, but I’m not sure I trust that much of an increase beween 2014 and 2015 either.</p>
<p>Nevertheless, lets keep going with an effort now towards modeling this time series between 2008 and the end of 2013 (somewhat cleanish/valid data). Just to zoom in a bit, I’d like to examine the seasonality of <code>Malt and malt products</code>.</p>
<pre class="r"><code>hops2 &lt;- brewing_materials %&gt;%
  mutate(date = make_date(year, month)) %&gt;%
  filter(date &gt;= &#39;2008-01-01&#39; &amp; date &lt;= &#39;2013-12-01&#39;) %&gt;%
  group_by(date, type) %&gt;%  
  summarize(avg = mean(month_current)) %&gt;% ungroup() %&gt;%
  filter(type == &#39;Malt and malt products&#39;) %&gt;%
  mutate(date = ymd(date, truncated = 1))</code></pre>
<p>Let’s take a look with just this vantage.</p>
<pre class="r"><code>time_series2 &lt;- hops2 %&gt;%
  ggplot(aes(x = date, y = avg, group = type)) + 
  geom_line(aes(color = type)) + 
  theme(axis.text.x = element_text(angle = 90))
time_series2</code></pre>
<p><img src="/post/TidyTuesday/tt_2020_w14_beer_files/figure-html/unnamed-chunk-5-1.png" width="768" /></p>
<pre class="r"><code>class(hops2)</code></pre>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<p>To model this, I’d like to push this time series into a <code>tsibble</code> to classify it as temporal data.</p>
<pre class="r"><code>library(tsibble)
tsibble &lt;- as_tsibble(hops2, index = date, key = type)</code></pre>
<pre class="r"><code>class(tsibble$date)</code></pre>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<pre class="r"><code>head(tsibble$date)</code></pre>
<pre><code>## [1] &quot;2008-01-01&quot; &quot;2008-02-01&quot; &quot;2008-03-01&quot; &quot;2008-04-01&quot; &quot;2008-05-01&quot;
## [6] &quot;2008-06-01&quot;</code></pre>
<p>I fought with this for a good while. Lesson learned. Although this variable <code>ts$date</code> identifies as a ‘Date’ variable, it is not in the right or correct interval.</p>
<p>Lets take a look. Notice the structure of the <code>date</code> variable below, it is in `%Y-%m-%d’.</p>
<p>In the end, this forecasts daily, not monthly. We must coerce this variable’s interval as a month.</p>
<pre class="r"><code>head(tsibble)</code></pre>
<pre><code>## # A tsibble: 6 x 3 [1D]
## # Key:       type [1]
##   date       type                         avg
##   &lt;date&gt;     &lt;chr&gt;                      &lt;dbl&gt;
## 1 2008-01-01 Malt and malt products 374165152
## 2 2008-02-01 Malt and malt products 355687578
## 3 2008-03-01 Malt and malt products 399855819
## 4 2008-04-01 Malt and malt products 388639443
## 5 2008-05-01 Malt and malt products 411307544
## 6 2008-06-01 Malt and malt products 415161326</code></pre>
<p>In this instance, I knew I wanted to use the <code>forecastLM</code> developmental package which takes a tsibble or ts object. However, it does not have internal checks to determine your data align with the interval for which you’ve situated.</p>
<p>In my case, I did not originally situate an interval for the tsibble object I created and ran into problems during forecasting.</p>
<p>How to set a <code>year month</code> interval in tsibble using the <code>yearmonth</code> function:</p>
<pre class="r"><code>tsibble &lt;- tsibble %&gt;%
  mutate(date = yearmonth(date))</code></pre>
<pre class="r"><code>class(tsibble$date)</code></pre>
<pre><code>## [1] &quot;yearmonth&quot; &quot;Date&quot;</code></pre>
<p>This allows forecastLM to make predictions on a monthly basis, not daily…</p>
<pre class="r"><code>class(tsibble)</code></pre>
<pre><code>## [1] &quot;tbl_ts&quot;     &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<p>Visualize using the TSstudio package from <code>Rami Krispin</code>, which takes a ts object as input for graphics. So lets make a ts object, as opposed to the tsibble.</p>
<pre class="r"><code>library(TSstudio) 
seasonal &lt;- ts(data = tsibble$avg, start = c(2008, 1), end = c(2013, 12), frequency = 12)
ts_plot(seasonal,
        line.mode = &quot;lines+markers&quot;,
        Ygrid = T, slider = T,
        title = &quot;Malts Over Time&quot;,
        Ytitle = &quot;Millions of Barrels&quot;)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:100%;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"visdat":{"4b574ac00d6":["function () ","plotlyVisDat"]},"cur_data":"4b574ac00d6","attrs":{"4b574ac00d6":{"x":{},"y":{},"mode":"lines+markers","marker":{"color":"#00526d"},"line":{"width":2,"dash":null,"color":"#00526d"},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"rangeslider":{"type":"date"},"title":"","showgrid":false},"yaxis":{"domain":[0,1],"automargin":true,"title":"Millions of Barrels","showgrid":true},"title":"Malts Over Time","hovermode":"closest","showlegend":false},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[2008,2008.08333333333,2008.16666666667,2008.25,2008.33333333333,2008.41666666667,2008.5,2008.58333333333,2008.66666666667,2008.75,2008.83333333333,2008.91666666667,2009,2009.08333333333,2009.16666666667,2009.25,2009.33333333333,2009.41666666667,2009.5,2009.58333333333,2009.66666666667,2009.75,2009.83333333333,2009.91666666667,2010,2010.08333333333,2010.16666666667,2010.25,2010.33333333333,2010.41666666667,2010.5,2010.58333333333,2010.66666666667,2010.75,2010.83333333333,2010.91666666667,2011,2011.08333333333,2011.16666666667,2011.25,2011.33333333333,2011.41666666667,2011.5,2011.58333333333,2011.66666666667,2011.75,2011.83333333333,2011.91666666667,2012,2012.08333333333,2012.16666666667,2012.25,2012.33333333333,2012.41666666667,2012.5,2012.58333333333,2012.66666666667,2012.75,2012.83333333333,2012.91666666667,2013,2013.08333333333,2013.16666666667,2013.25,2013.33333333333,2013.41666666667,2013.5,2013.58333333333,2013.66666666667,2013.75,2013.83333333333,2013.91666666667],"y":[374165152,355687578,399855819,388639443,411307544,415161326,405393784,389391266,362587470,353803777,322733711,318741733,361377478,339472713,380133298,384396702,391469434,381247341,382672919,362521445,370369895,333286901,309688888,302237874,330304432,305543380,366733254,374018118,399504457,380521275,384726834,358726926,329671455,333230020,298251207,285382073,322480722,307076591,363234183,349781343,352623620,372541998,350751002,361924350,312845217,313380880,303152329,293640890,315214803,320430694,366122047,357106000,373071360,387306474,363222892,362799587,336789908,321542825,295672895,299861553,326450615,311283986,340319408,334351807,353589770,370101067,367999200,339968116,303711377,321371392,275715285,294248188],"mode":"lines+markers","marker":{"color":"#00526d","line":{"color":"rgba(31,119,180,1)"}},"line":{"color":"#00526d","width":2,"dash":[]},"type":"scatter","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>To better understand the seaonality, we can examine the autocorrelation and the partial autocorrelation functions from their correlograms (such a great name!).</p>
<pre class="r"><code>ts_cor(seasonal, seasonal_lags = 12, lag.max = 36)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:100%;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"data":[{"x":[0],"y":[1],"type":"bar","marker":{"color":"black","line":{"color":"rgba(31,119,180,1)"}},"width":0.1,"name":"Lag-Zero","legendgroup":"lagzero","showlegend":false,"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[12,24,36],"y":[0.66984705301863,0.491998177392291,0.29180007290906],"type":"bar","marker":{"color":"red","line":{"color":"rgba(255,127,14,1)"}},"width":[0.1,0.1,0.1],"legendgroup":"seasonal","name":"Seasonal Lag 12","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,25,26,27,28,29,30,31,32,33,34,35],"y":[0.723390258752668,0.54651297307907,0.210760732025738,-0.116463134408554,-0.308173679655856,-0.412385503138572,-0.304376943194867,-0.154537944639862,0.10782029852227,0.39439351334433,0.502931846157896,0.497534561045211,0.348939549530162,0.0682289962084897,-0.189634487244068,-0.358703241819214,-0.455433502481345,-0.361742920675131,-0.23363218285423,0.0133514221062892,0.264385771373448,0.384210105058375,0.340827022593848,0.24614630597541,0.0082622255602775,-0.200392633660466,-0.31599906740045,-0.403140712911446,-0.326924364015072,-0.238663768922177,-0.0472528265073832,0.126364650951977,0.196136423759385],"type":"bar","marker":{"color":"#00526d","line":{"color":"rgba(44,160,44,1)"}},"width":[0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1],"legendgroup":"nonseasonal","name":"Non-Seasonal","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0,36],"y":[0.230983970724946,0.230983970724946],"type":"scatter","mode":"lines","line":{"color":"green","dash":"dash"},"legendgroup":"ci","showlegend":false,"name":"CI Upper Bound","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0,36],"y":[-0.230983970724946,-0.230983970724946],"type":"scatter","mode":"lines","line":{"color":"green","dash":"dash"},"legendgroup":"ci","showlegend":false,"name":"CI Lower Bound","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[12,24,36],"y":[0.274837444419328,-0.0994657323089509,0.0309013418802561],"type":"bar","marker":{"color":"red","line":{"color":"rgba(140,86,75,1)"}},"width":[0.1,0.1,0.1],"legendgroup":"seasonal","showlegend":false,"name":"Seasonal Lag 12","error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y2","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,25,26,27,28,29,30,31,32,33,34,35],"y":[0.723390258752668,0.0487081778558927,-0.421720697202504,-0.373361799604652,0.0412506501845912,0.122047310477222,0.278368490120071,0.0687634342621276,0.118799910715317,0.304723356098897,-0.0772805707813854,-0.26226169719159,-0.0523378092556009,-0.066371201304416,0.0188274155138167,-0.0623982715398475,-0.0410043687995648,-0.01780830173765,-0.03620862413379,0.117637616396157,0.0083671668197475,0.00787978396330086,-0.143144015166183,0.219366027782832,0.0994676388065936,-0.0982549867800898,-0.0408106472700957,-0.0323228401628937,0.00942314061729214,-0.033012554269575,-0.0836804389282428,-0.0937546744988896,-0.104985521648523],"type":"bar","marker":{"color":"#00526d","line":{"color":"rgba(227,119,194,1)"}},"width":[0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1],"legendgroup":"nonseasonal","showlegend":false,"name":"Non-Seasonal","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y2","frame":null},{"x":[1,36],"y":[0.230983970724946,0.230983970724946],"type":"scatter","mode":"lines","line":{"color":"green","dash":"dash"},"legendgroup":"ci","showlegend":false,"name":"CI Upper Bound","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y2","frame":null},{"x":[1,36],"y":[-0.230983970724946,-0.230983970724946],"type":"scatter","mode":"lines","line":{"color":"green","dash":"dash"},"legendgroup":"ci","showlegend":false,"name":"CI Lower Bound","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x","yaxis":"y2","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"dtick":12,"title":"Lag","anchor":"y2"},"yaxis2":{"domain":[0,0.48],"automargin":true,"title":"PACF","anchor":"x"},"yaxis":{"domain":[0.52,1],"automargin":true,"title":"ACF","anchor":"x"},"annotations":[],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"hovermode":"compare","showlegend":true,"title":"seasonal ACF and PACF Plots"},"attrs":{"52aac7aa64b":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36],"y":[1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"type":"bar","marker":{"color":"black"},"width":0.1,"name":"Lag-Zero","legendgroup":"lagzero","showlegend":false,"inherit":true},"52aac7aa64b.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36],"y":[null,null,null,null,null,null,null,null,null,null,null,null,0.66984705301863,null,null,null,null,null,null,null,null,null,null,null,0.491998177392291,null,null,null,null,null,null,null,null,null,null,null,0.29180007290906],"type":"bar","marker":{"color":"red"},"width":0.1,"legendgroup":"seasonal","name":"Seasonal Lag 12","inherit":true},"52aac7aa64b.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36],"y":[null,0.723390258752668,0.54651297307907,0.210760732025738,-0.116463134408554,-0.308173679655856,-0.412385503138572,-0.304376943194867,-0.154537944639862,0.10782029852227,0.39439351334433,0.502931846157896,null,0.497534561045211,0.348939549530162,0.0682289962084897,-0.189634487244068,-0.358703241819214,-0.455433502481345,-0.361742920675131,-0.23363218285423,0.0133514221062892,0.264385771373448,0.384210105058375,null,0.340827022593848,0.24614630597541,0.0082622255602775,-0.200392633660466,-0.31599906740045,-0.403140712911446,-0.326924364015072,-0.238663768922177,-0.0472528265073832,0.126364650951977,0.196136423759385,null],"type":"bar","marker":{"color":"#00526d"},"width":0.1,"legendgroup":"nonseasonal","name":"Non-Seasonal","inherit":true},"52aac7aa64b.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":0,"y":0.230983970724946,"xend":36,"yend":0.230983970724946,"type":"scatter","mode":"lines","line":{"color":"green","dash":"dash"},"legendgroup":"ci","showlegend":false,"name":"CI Upper Bound","inherit":true},"52aac7aa64b.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":0,"y":-0.230983970724946,"xend":36,"yend":-0.230983970724946,"type":"scatter","mode":"lines","line":{"color":"green","dash":"dash"},"legendgroup":"ci","showlegend":false,"name":"CI Lower Bound","inherit":true},"52aa483b8c53":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36],"y":[null,null,null,null,null,null,null,null,null,null,null,0.274837444419328,null,null,null,null,null,null,null,null,null,null,null,-0.0994657323089509,null,null,null,null,null,null,null,null,null,null,null,0.0309013418802561],"type":"bar","marker":{"color":"red"},"width":0.1,"legendgroup":"seasonal","showlegend":false,"name":"Seasonal Lag 12","inherit":true},"52aa483b8c53.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36],"y":[0.723390258752668,0.0487081778558927,-0.421720697202504,-0.373361799604652,0.0412506501845912,0.122047310477222,0.278368490120071,0.0687634342621276,0.118799910715317,0.304723356098897,-0.0772805707813854,null,-0.26226169719159,-0.0523378092556009,-0.066371201304416,0.0188274155138167,-0.0623982715398475,-0.0410043687995648,-0.01780830173765,-0.03620862413379,0.117637616396157,0.0083671668197475,0.00787978396330086,null,-0.143144015166183,0.219366027782832,0.0994676388065936,-0.0982549867800898,-0.0408106472700957,-0.0323228401628937,0.00942314061729214,-0.033012554269575,-0.0836804389282428,-0.0937546744988896,-0.104985521648523,null],"type":"bar","marker":{"color":"#00526d"},"width":0.1,"legendgroup":"nonseasonal","showlegend":false,"name":"Non-Seasonal","inherit":true},"52aa483b8c53.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":1,"y":0.230983970724946,"xend":36,"yend":0.230983970724946,"type":"scatter","mode":"lines","line":{"color":"green","dash":"dash"},"legendgroup":"ci","showlegend":false,"name":"CI Upper Bound","inherit":true},"52aa483b8c53.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":1,"y":-0.230983970724946,"xend":36,"yend":-0.230983970724946,"type":"scatter","mode":"lines","line":{"color":"green","dash":"dash"},"legendgroup":"ci","showlegend":false,"name":"CI Lower Bound","inherit":true}},"source":"A","config":{"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>In this case (considering approximate stationarity–I will not be venturing into differencing in this post), it is evident that this is an autocorrelated series with clear declining trend–as presented by the ACF plot’s clear decline over time. In this case, there seems to be a clear higher-order autoregressive term in the data.</p>
<p>To examine this term we can use the PACF plot, which looks at the residuals of the ACF (essentially), which suggests that most of the autocorrelation across seasons is simply because of the strong lag-1 autocorrelation. We will keep this in the model.</p>
<pre class="r"><code>ts_seasonal(seasonal, type = &#39;all&#39;)</code></pre>
<div id="htmlwidget-2" style="width:100%;height:100%;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"data":[{"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[374165152,355687578,399855819,388639443,411307544,415161326,405393784,389391266,362587470,353803777,322733711,318741733],"type":"scatter","mode":"lines","name":"2008","line":{"color":"#440154FF"},"marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[361377478,339472713,380133298,384396702,391469434,381247341,382672919,362521445,370369895,333286901,309688888,302237874],"type":"scatter","mode":"lines","name":"2009","line":{"color":"#443A83FF"},"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[330304432,305543380,366733254,374018118,399504457,380521275,384726834,358726926,329671455,333230020,298251207,285382073],"type":"scatter","mode":"lines","name":"2010","line":{"color":"#31688EFF"},"marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[322480722,307076591,363234183,349781343,352623620,372541998,350751002,361924350,312845217,313380880,303152329,293640890],"type":"scatter","mode":"lines","name":"2011","line":{"color":"#21908CFF"},"marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[315214803,320430694,366122047,357106000,373071360,387306474,363222892,362799587,336789908,321542825,295672895,299861553],"type":"scatter","mode":"lines","name":"2012","line":{"color":"#35B779FF"},"marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[326450615,311283986,340319408,334351807,353589770,370101067,367999200,339968116,303711377,321371392,275715285,294248188],"type":"scatter","mode":"lines","name":"2013","line":{"color":"#8FD744FF"},"marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["Jan"],"y":[315728713],"type":"scatter","mode":"lines","name":"2014","line":{"color":"#FDE725FF"},"marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2008,2009,2010,2011,2012,2013,2014],"y":[374165152,361377478,330304432,322480722,315214803,326450615,315728713],"type":"scatter","mode":"lines","name":"Jan","line":{"color":"#E41A1C"},"showlegend":true,"legendgroup":"all_Jan","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[2008,2009,2010,2011,2012,2013],"y":[355687578,339472713,305543380,307076591,320430694,311283986],"type":"scatter","mode":"lines","name":"Feb","line":{"color":"#66628D"},"showlegend":true,"legendgroup":"all_Feb","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[2008,2009,2010,2011,2012,2013],"y":[399855819,380133298,366733254,363234183,366122047,340319408],"type":"scatter","mode":"lines","name":"Mar","line":{"color":"#419486"},"showlegend":true,"legendgroup":"all_Mar","marker":{"color":"rgba(23,190,207,1)","line":{"color":"rgba(23,190,207,1)"}},"error_y":{"color":"rgba(23,190,207,1)"},"error_x":{"color":"rgba(23,190,207,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[2008,2009,2010,2011,2012,2013],"y":[388639443,384396702,374018118,349781343,357106000,334351807],"type":"scatter","mode":"lines","name":"Apr","line":{"color":"#5A9D5A"},"showlegend":true,"legendgroup":"all_Apr","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[2008,2009,2010,2011,2012,2013],"y":[411307544,391469434,399504457,352623620,373071360,353589770],"type":"scatter","mode":"lines","name":"May","line":{"color":"#91569A"},"showlegend":true,"legendgroup":"all_May","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[2008,2009,2010,2011,2012,2013],"y":[415161326,381247341,380521275,372541998,387306474,370101067],"type":"scatter","mode":"lines","name":"Jun","line":{"color":"#D96D3B"},"showlegend":true,"legendgroup":"all_Jun","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[2008,2009,2010,2011,2012,2013],"y":[405393784,382672919,384726834,350751002,363222892,367999200],"type":"scatter","mode":"lines","name":"Jul","line":{"color":"#FFAD12"},"showlegend":true,"legendgroup":"all_Jul","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[2008,2009,2010,2011,2012,2013],"y":[389391266,362521445,358726926,361924350,362799587,339968116],"type":"scatter","mode":"lines","name":"Aug","line":{"color":"#F6EF32"},"showlegend":true,"legendgroup":"all_Aug","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[2008,2009,2010,2011,2012,2013],"y":[362587470,370369895,329671455,312845217,336789908,303711377],"type":"scatter","mode":"lines","name":"Sep","line":{"color":"#B6742A"},"showlegend":true,"legendgroup":"all_Sep","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[2008,2009,2010,2011,2012,2013],"y":[353803777,333286901,333230020,313380880,321542825,321371392],"type":"scatter","mode":"lines","name":"Oct","line":{"color":"#D26D7A"},"showlegend":true,"legendgroup":"all_Oct","marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[2008,2009,2010,2011,2012,2013],"y":[322733711,309688888,298251207,303152329,295672895,275715285],"type":"scatter","mode":"lines","name":"Nov","line":{"color":"#DD87B4"},"showlegend":true,"legendgroup":"all_Nov","marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[2008,2009,2010,2011,2012,2013],"y":[318741733,302237874,285382073,293640890,299861553,294248188],"type":"scatter","mode":"lines","name":"Dec","line":{"color":"#999999"},"showlegend":true,"legendgroup":"all_Dec","marker":{"color":"rgba(188,189,34,1)","line":{"color":"rgba(188,189,34,1)"}},"error_y":{"color":"rgba(188,189,34,1)"},"error_x":{"color":"rgba(188,189,34,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"fillcolor":"rgba(228,26,28, 0.5)","y":[374165152,361377478,330304432,322480722,315214803,326450615,315728713],"type":"box","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C","line":{"color":"rgba(23,190,207,1)"}},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Jan","showlegend":false,"legendgroup":"all_Jan","xaxis":"x3","yaxis":"y3","frame":null},{"fillcolor":"rgba(102,98,141, 0.5)","y":[355687578,339472713,305543380,307076591,320430694,311283986],"type":"box","line":{"color":"#66628D"},"marker":{"color":"#66628D","line":{"color":"rgba(31,119,180,1)"}},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Feb","showlegend":false,"legendgroup":"all_Feb","xaxis":"x3","yaxis":"y3","frame":null},{"fillcolor":"rgba(65,148,134, 0.5)","y":[399855819,380133298,366733254,363234183,366122047,340319408],"type":"box","line":{"color":"#419486"},"marker":{"color":"#419486","line":{"color":"rgba(255,127,14,1)"}},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Mar","showlegend":false,"legendgroup":"all_Mar","xaxis":"x3","yaxis":"y3","frame":null},{"fillcolor":"rgba(90,157,90, 0.5)","y":[388639443,384396702,374018118,349781343,357106000,334351807],"type":"box","line":{"color":"#5A9D5A"},"marker":{"color":"#5A9D5A","line":{"color":"rgba(44,160,44,1)"}},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Apr","showlegend":false,"legendgroup":"all_Apr","xaxis":"x3","yaxis":"y3","frame":null},{"fillcolor":"rgba(145,86,154, 0.5)","y":[411307544,391469434,399504457,352623620,373071360,353589770],"type":"box","line":{"color":"#91569A"},"marker":{"color":"#91569A","line":{"color":"rgba(214,39,40,1)"}},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"May","showlegend":false,"legendgroup":"all_May","xaxis":"x3","yaxis":"y3","frame":null},{"fillcolor":"rgba(217,109,59, 0.5)","y":[415161326,381247341,380521275,372541998,387306474,370101067],"type":"box","line":{"color":"#D96D3B"},"marker":{"color":"#D96D3B","line":{"color":"rgba(148,103,189,1)"}},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Jun","showlegend":false,"legendgroup":"all_Jun","xaxis":"x3","yaxis":"y3","frame":null},{"fillcolor":"rgba(255,173,18, 0.5)","y":[405393784,382672919,384726834,350751002,363222892,367999200],"type":"box","line":{"color":"#FFAD12"},"marker":{"color":"#FFAD12","line":{"color":"rgba(140,86,75,1)"}},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Jul","showlegend":false,"legendgroup":"all_Jul","xaxis":"x3","yaxis":"y3","frame":null},{"fillcolor":"rgba(246,239,50, 0.5)","y":[389391266,362521445,358726926,361924350,362799587,339968116],"type":"box","line":{"color":"#F6EF32"},"marker":{"color":"#F6EF32","line":{"color":"rgba(227,119,194,1)"}},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Aug","showlegend":false,"legendgroup":"all_Aug","xaxis":"x3","yaxis":"y3","frame":null},{"fillcolor":"rgba(182,116,42, 0.5)","y":[362587470,370369895,329671455,312845217,336789908,303711377],"type":"box","line":{"color":"#B6742A"},"marker":{"color":"#B6742A","line":{"color":"rgba(127,127,127,1)"}},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Sep","showlegend":false,"legendgroup":"all_Sep","xaxis":"x3","yaxis":"y3","frame":null},{"fillcolor":"rgba(210,109,122, 0.5)","y":[353803777,333286901,333230020,313380880,321542825,321371392],"type":"box","line":{"color":"#D26D7A"},"marker":{"color":"#D26D7A","line":{"color":"rgba(188,189,34,1)"}},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Oct","showlegend":false,"legendgroup":"all_Oct","xaxis":"x3","yaxis":"y3","frame":null},{"fillcolor":"rgba(221,135,180, 0.5)","y":[322733711,309688888,298251207,303152329,295672895,275715285],"type":"box","line":{"color":"#DD87B4"},"marker":{"color":"#DD87B4","line":{"color":"rgba(23,190,207,1)"}},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Nov","showlegend":false,"legendgroup":"all_Nov","xaxis":"x3","yaxis":"y3","frame":null},{"fillcolor":"rgba(153,153,153, 0.5)","y":[318741733,302237874,285382073,293640890,299861553,294248188],"type":"box","line":{"color":"#999999"},"marker":{"color":"#999999","line":{"color":"rgba(31,119,180,1)"}},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Dec","showlegend":false,"legendgroup":"all_Dec","xaxis":"x3","yaxis":"y3","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"type":"category","categoryorder":"array","categoryarray":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"anchor":"y"},"xaxis2":{"domain":[0,1],"automargin":true,"anchor":"y2"},"xaxis3":{"domain":[0,1],"automargin":true,"anchor":"y3"},"yaxis3":{"domain":[0,0.313333333333333],"automargin":true,"title":"By Frequency Unit","anchor":"x3"},"yaxis2":{"domain":[0.353333333333333,0.646666666666667],"automargin":true,"title":"By Frequency Unit","anchor":"x2"},"yaxis":{"domain":[0.686666666666667,1],"automargin":true,"title":"By Frequency Cycle","anchor":"x"},"annotations":[],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"hovermode":"closest","showlegend":true,"title":"Seasonality Plot - seasonal"},"attrs":{"47f0525dd35f":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[374165152,355687578,399855819,388639443,411307544,415161326,405393784,389391266,362587470,353803777,322733711,318741733],"type":"scatter","mode":"lines","name":2008,"line":{"color":"#440154FF"},"inherit":true},"47f0525dd35f.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[361377478,339472713,380133298,384396702,391469434,381247341,382672919,362521445,370369895,333286901,309688888,302237874],"type":"scatter","mode":"lines","name":2009,"line":{"color":"#443A83FF"},"inherit":true},"47f0525dd35f.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[330304432,305543380,366733254,374018118,399504457,380521275,384726834,358726926,329671455,333230020,298251207,285382073],"type":"scatter","mode":"lines","name":2010,"line":{"color":"#31688EFF"},"inherit":true},"47f0525dd35f.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[322480722,307076591,363234183,349781343,352623620,372541998,350751002,361924350,312845217,313380880,303152329,293640890],"type":"scatter","mode":"lines","name":2011,"line":{"color":"#21908CFF"},"inherit":true},"47f0525dd35f.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[315214803,320430694,366122047,357106000,373071360,387306474,363222892,362799587,336789908,321542825,295672895,299861553],"type":"scatter","mode":"lines","name":2012,"line":{"color":"#35B779FF"},"inherit":true},"47f0525dd35f.5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"y":[326450615,311283986,340319408,334351807,353589770,370101067,367999200,339968116,303711377,321371392,275715285,294248188],"type":"scatter","mode":"lines","name":2013,"line":{"color":"#8FD744FF"},"inherit":true},"47f0525dd35f.6":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":"Jan","y":315728713,"type":"scatter","mode":"lines","name":2014,"line":{"color":"#FDE725FF"},"inherit":true},"47f0de02c38":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2008,2009,2010,2011,2012,2013,2014],"y":[374165152,361377478,330304432,322480722,315214803,326450615,315728713],"type":"scatter","mode":"lines","name":"Jan","line":{"color":"#E41A1C"},"showlegend":true,"legendgroup":"all_Jan","inherit":true},"47f0de02c38.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2008,2009,2010,2011,2012,2013,2014],"y":[355687578,339472713,305543380,307076591,320430694,311283986,null],"type":"scatter","mode":"lines","name":"Feb","line":{"color":"#66628D"},"showlegend":true,"legendgroup":"all_Feb","inherit":true},"47f0de02c38.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2008,2009,2010,2011,2012,2013,2014],"y":[399855819,380133298,366733254,363234183,366122047,340319408,null],"type":"scatter","mode":"lines","name":"Mar","line":{"color":"#419486"},"showlegend":true,"legendgroup":"all_Mar","inherit":true},"47f0de02c38.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2008,2009,2010,2011,2012,2013,2014],"y":[388639443,384396702,374018118,349781343,357106000,334351807,null],"type":"scatter","mode":"lines","name":"Apr","line":{"color":"#5A9D5A"},"showlegend":true,"legendgroup":"all_Apr","inherit":true},"47f0de02c38.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2008,2009,2010,2011,2012,2013,2014],"y":[411307544,391469434,399504457,352623620,373071360,353589770,null],"type":"scatter","mode":"lines","name":"May","line":{"color":"#91569A"},"showlegend":true,"legendgroup":"all_May","inherit":true},"47f0de02c38.5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2008,2009,2010,2011,2012,2013,2014],"y":[415161326,381247341,380521275,372541998,387306474,370101067,null],"type":"scatter","mode":"lines","name":"Jun","line":{"color":"#D96D3B"},"showlegend":true,"legendgroup":"all_Jun","inherit":true},"47f0de02c38.6":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2008,2009,2010,2011,2012,2013,2014],"y":[405393784,382672919,384726834,350751002,363222892,367999200,null],"type":"scatter","mode":"lines","name":"Jul","line":{"color":"#FFAD12"},"showlegend":true,"legendgroup":"all_Jul","inherit":true},"47f0de02c38.7":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2008,2009,2010,2011,2012,2013,2014],"y":[389391266,362521445,358726926,361924350,362799587,339968116,null],"type":"scatter","mode":"lines","name":"Aug","line":{"color":"#F6EF32"},"showlegend":true,"legendgroup":"all_Aug","inherit":true},"47f0de02c38.8":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2008,2009,2010,2011,2012,2013,2014],"y":[362587470,370369895,329671455,312845217,336789908,303711377,null],"type":"scatter","mode":"lines","name":"Sep","line":{"color":"#B6742A"},"showlegend":true,"legendgroup":"all_Sep","inherit":true},"47f0de02c38.9":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2008,2009,2010,2011,2012,2013,2014],"y":[353803777,333286901,333230020,313380880,321542825,321371392,null],"type":"scatter","mode":"lines","name":"Oct","line":{"color":"#D26D7A"},"showlegend":true,"legendgroup":"all_Oct","inherit":true},"47f0de02c38.10":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2008,2009,2010,2011,2012,2013,2014],"y":[322733711,309688888,298251207,303152329,295672895,275715285,null],"type":"scatter","mode":"lines","name":"Nov","line":{"color":"#DD87B4"},"showlegend":true,"legendgroup":"all_Nov","inherit":true},"47f0de02c38.11":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2008,2009,2010,2011,2012,2013,2014],"y":[318741733,302237874,285382073,293640890,299861553,294248188,null],"type":"scatter","mode":"lines","name":"Dec","line":{"color":"#999999"},"showlegend":true,"legendgroup":"all_Dec","inherit":true},"47f052b18f6c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"box","fillcolor":"rgba(228,26,28, 0.5)","line":{"color":"#E41A1C"},"marker":{"color":"#E41A1C"},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Jan","showlegend":false,"legendgroup":"all_Jan","inherit":true},"47f073f25de":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"box","fillcolor":"rgba(102,98,141, 0.5)","line":{"color":"#66628D"},"marker":{"color":"#66628D"},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Feb","showlegend":false,"legendgroup":"all_Feb","inherit":true},"47f042cf1589":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"box","fillcolor":"rgba(65,148,134, 0.5)","line":{"color":"#419486"},"marker":{"color":"#419486"},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Mar","showlegend":false,"legendgroup":"all_Mar","inherit":true},"47f0298ef7a3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"box","fillcolor":"rgba(90,157,90, 0.5)","line":{"color":"#5A9D5A"},"marker":{"color":"#5A9D5A"},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Apr","showlegend":false,"legendgroup":"all_Apr","inherit":true},"47f0692403a5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"box","fillcolor":"rgba(145,86,154, 0.5)","line":{"color":"#91569A"},"marker":{"color":"#91569A"},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"May","showlegend":false,"legendgroup":"all_May","inherit":true},"47f03b6b7b90":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"box","fillcolor":"rgba(217,109,59, 0.5)","line":{"color":"#D96D3B"},"marker":{"color":"#D96D3B"},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Jun","showlegend":false,"legendgroup":"all_Jun","inherit":true},"47f0d7d496a":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"box","fillcolor":"rgba(255,173,18, 0.5)","line":{"color":"#FFAD12"},"marker":{"color":"#FFAD12"},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Jul","showlegend":false,"legendgroup":"all_Jul","inherit":true},"47f01c5ed511":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"box","fillcolor":"rgba(246,239,50, 0.5)","line":{"color":"#F6EF32"},"marker":{"color":"#F6EF32"},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Aug","showlegend":false,"legendgroup":"all_Aug","inherit":true},"47f015f65da4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"box","fillcolor":"rgba(182,116,42, 0.5)","line":{"color":"#B6742A"},"marker":{"color":"#B6742A"},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Sep","showlegend":false,"legendgroup":"all_Sep","inherit":true},"47f0617dc53f":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"box","fillcolor":"rgba(210,109,122, 0.5)","line":{"color":"#D26D7A"},"marker":{"color":"#D26D7A"},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Oct","showlegend":false,"legendgroup":"all_Oct","inherit":true},"47f0820dd1a":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"box","fillcolor":"rgba(221,135,180, 0.5)","line":{"color":"#DD87B4"},"marker":{"color":"#DD87B4"},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Nov","showlegend":false,"legendgroup":"all_Nov","inherit":true},"47f02593da21":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"box","fillcolor":"rgba(153,153,153, 0.5)","line":{"color":"#999999"},"marker":{"color":"#999999"},"boxpoints":"all","jitter":0.3,"pointpos":-1.8,"name":"Dec","showlegend":false,"legendgroup":"all_Dec","inherit":true}},"source":"A","config":{"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>From this, it appears there is a strong sesonality–with a bit of obvious variability. However, there does appear to be a noticable decline across the entire year as time moves. This trend is also evident in the plot above this one, whereby there appears to be a fairly linear decline over time.</p>
<p>I’ll use a developmental R package <code>forecastLM</code> to examine the seasonality. You can find more details <a href="https://github.com/RamiKrispin/forecastLM">here</a>.</p>
<p>Initial model.</p>
<pre class="r"><code>library(forecastLM)
lm1 &lt;- trainLM(input = tsibble,
               y = &quot;avg&quot;,
               trend = list(linear = TRUE),
               seasonal = &quot;month&quot;)</code></pre>
<pre class="r"><code>summary(lm1$model)</code></pre>
<pre><code>## 
## Call:
## stats::lm(formula = f, data = df1)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -23476646  -8276435   1060833   8795520  21891713 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  360761182    4978760  72.460  &lt; 2e-16 ***
## monthFeb     -15321278    6431251  -2.382   0.0204 *  
## monthMar      31522694    6428313   4.904 7.51e-06 ***
## monthApr      27532056    6426027   4.284 6.73e-05 ***
## monthMay      43770978    6424394   6.813 5.20e-09 ***
## monthJun      48683322    6423414   7.579 2.57e-10 ***
## monthJul      40691308    6423087   6.335 3.36e-08 ***
## monthAug      28145612    6423414   4.382 4.81e-05 ***
## monthSep       2279678    6424394   0.355   0.7239    
## monthOct      -3586782    6426027  -0.558   0.5788    
## monthNov     -31460235    6428313  -4.894 7.78e-06 ***
## monthDec     -32617108    6431251  -5.072 4.07e-06 ***
## linear_trend   -693461      64790 -10.703 1.53e-15 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11550000 on 60 degrees of freedom
## Multiple R-squared:  0.9038, Adjusted R-squared:  0.8846 
## F-statistic:    47 on 12 and 60 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>To see how much the ar1 can help, we can put a lag in.</p>
<pre class="r"><code>lm2  &lt;- trainLM(input = tsibble,
               y = &quot;avg&quot;,
               trend = list(linear = TRUE),
               seasonal = &quot;month&quot;, 
               lags = c(1))</code></pre>
<pre class="r"><code>summary(lm2$model)</code></pre>
<pre><code>## 
## Call:
## stats::lm(formula = f, data = df1)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -20299890  -7509728    581799   7354108  26464076 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   2.478e+08  4.049e+07   6.121 8.61e-08 ***
## monthFeb     -2.329e+07  7.403e+06  -3.146 0.002610 ** 
## monthMar      2.833e+07  6.654e+06   4.257 7.67e-05 ***
## monthApr      8.695e+06  1.004e+07   0.866 0.390233    
## monthMay      2.624e+07  9.667e+06   2.715 0.008726 ** 
## monthJun      2.572e+07  1.124e+07   2.288 0.025818 *  
## monthJul      1.607e+07  1.174e+07   1.368 0.176502    
## monthAug      6.162e+06  1.093e+07   0.564 0.575050    
## monthSep     -1.554e+07  9.717e+06  -1.600 0.115142    
## monthOct     -1.281e+07  7.590e+06  -1.687 0.096921 .  
## monthNov     -3.875e+07  7.212e+06  -5.372 1.44e-06 ***
## monthDec     -3.063e+07  6.285e+06  -4.874 8.86e-06 ***
## linear_trend -4.401e+05  1.060e+05  -4.152 0.000109 ***
## lag_1         3.334e-01  1.220e-01   2.733 0.008296 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 10880000 on 58 degrees of freedom
## Multiple R-squared:  0.9166, Adjusted R-squared:  0.898 
## F-statistic: 49.06 on 13 and 58 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>plot_res(lm2)</code></pre>
<div id="htmlwidget-3" style="width:100%;height:100%;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"data":[{"x":["2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01"],"y":[374165152,355687578,399855819,388639443,411307544,415161326,405393784,389391266,362587470,353803777,322733711,318741733,361377478,339472713,380133298,384396702,391469434,381247341,382672919,362521445,370369895,333286901,309688888,302237874,330304432,305543380,366733254,374018118,399504457,380521275,384726834,358726926,329671455,333230020,298251207,285382073,322480722,307076591,363234183,349781343,352623620,372541998,350751002,361924350,312845217,313380880,303152329,293640890,315214803,320430694,366122047,357106000,373071360,387306474,363222892,362799587,336789908,321542825,295672895,299861553,326450615,311283986,340319408,334351807,353589770,370101067,367999200,339968116,303711377,321371392,275715285,294248188,315728713],"mode":"lines","name":"Actual","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y2","frame":null},{"x":["2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01"],"y":[348399174.741656,393417827.413066,388072767.979986,401440134.224029,408033960.661261,399226747.980336,385626791.128781,358145992.557101,351504579.204165,322196180.437872,319511205.396472,348371179.667465,338854495.10022,382730399.147702,376215761.168455,394744642.278088,396138412.323831,382637797.148898,372770028.69229,343905819.111496,348818709.686333,310074307.126878,309880783.038656,337587390.418478,323212815.410926,366136330.741586,366466895.365573,386003239.805161,393536768.055454,377114891.007791,368174068.105807,337359780.485698,329967577.781429,304774531.309673,300786239.570857,326686251.060844,315323299.730364,361366748.731764,360019369.7189,372641018.505567,372624202.847203,369173503.699654,351564495.262306,333145106.887946,319076295.790241,292875305.173916,297139640.102937,324159227.753348,307619771.611537,360538676.858554,355701477.694156,369802512.688188,374161404.43567,368815700.861632,350442261.875553,328156132.704452,321779506.493227,290315981.260853,289364918.411169,320952610.668075,306085385.405297,352208026.107329,341817141.07293,356934637.498967,362384732.676581,357797990.301688,346754044.935263,315262490.253308,305469126.044605,284978009.690808,277429524.47991,313800103.431792],"mode":"lines","name":"Fitted","type":"scatter","line":{"color":"red","dash":"dash"},"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y2","frame":null},{"x":["2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01"],"y":[7288403.25834382,6437991.58693361,566675.020014167,9867409.77597088,7127365.3387385,6167036.01966399,3764474.8712188,4441477.44289851,2299197.79583454,537530.562128127,-769472.396472037,13006298.3325353,618217.899779558,-2597101.14770216,8180940.8315447,-3275208.27808815,-14891071.3238308,35121.8511016369,-10248583.6922902,26464075.8885044,-15531808.6863327,-385419.12687844,-7642909.03865576,-7282958.41847754,-17669435.4109264,596923.25841403,7551222.63442731,13501217.1948386,-13015493.0554537,7611942.99220908,-9447142.10580671,-7688325.48569763,3262442.21857136,-6523324.30967295,-15404166.5708569,-4205529.06084383,-8246708.73036414,1867434.26823634,-10238026.7189003,-20017398.5055666,-82204.8472031951,-18422501.6996542,10359854.737694,-20299889.8879462,-5695415.79024148,10277023.8260835,-3498750.10293657,-8944424.75334793,12810922.3884632,5583370.14144635,1404522.30584365,3268847.3118124,13145069.5643299,-5592808.86163241,12357325.1244472,8633775.29554844,-236681.493226588,5356913.73914742,10496634.5888309,5498004.33192527,5198600.59470284,-11888618.1073286,-7465334.07292962,-3344867.49896747,7716334.32341903,10201209.6983116,-6785928.9352631,-11551113.2533076,15902265.9553945,-9262724.69080794,16818663.5200903,1928609.56820846],"mode":"lines","line":{"color":"green"},"name":"Residuals","type":"scatter","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36],"y":[1,-0.101289536826226,0.178711737980437,0.0863376529049439,0.117175871485634,0.0802659790080488,0.176973882762771,0.0180363321823039,0.204061825623267,-0.17653945971638,0.167393091369312,-0.102081745964492,-0.065682782321495,0.0226532010142633,-0.0920164999301697,-0.0273125340817641,0.0536769473203515,-0.157871106084583,0.0352289479585346,0.0206817846211023,-0.0930816045026889,-0.063500819581696,-0.0514616536326213,0.205371148871077,-0.237287873196426,-0.043992892860997,0.0536474473754892,-0.14578768185331,0.00252590633451535,-0.108457935635606,-0.143867742307577,-0.0347312235356371,-0.171949505874354,0.00994548818439343,-0.19690683070824,-0.0987441975348699,-0.142926874059602],"type":"bar","width":[0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01],"showlegend":false,"marker":{"color":"#00526d","line":{"color":"#00526d"}},"name":"Autocorrelation","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x2","yaxis":"y4","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36],"y":[0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946,0.230983970724946],"type":"scatter","mode":"lines","line":{"color":"red","dash":"dash","width":1},"showlegend":false,"name":"CI Upper","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x2","yaxis":"y4","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36],"y":[-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946,-0.230983970724946],"type":"scatter","mode":"lines","line":{"color":"red","dash":"dash","width":1},"showlegend":false,"name":"CI Lower","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x2","yaxis":"y4","frame":null},{"x":[7288403.25834382,6437991.58693361,566675.020014167,9867409.77597088,7127365.3387385,6167036.01966399,3764474.8712188,4441477.44289851,2299197.79583454,537530.562128127,-769472.396472037,13006298.3325353,618217.899779558,-2597101.14770216,8180940.8315447,-3275208.27808815,-14891071.3238308,35121.8511016369,-10248583.6922902,26464075.8885044,-15531808.6863327,-385419.12687844,-7642909.03865576,-7282958.41847754,-17669435.4109264,596923.25841403,7551222.63442731,13501217.1948386,-13015493.0554537,7611942.99220908,-9447142.10580671,-7688325.48569763,3262442.21857136,-6523324.30967295,-15404166.5708569,-4205529.06084383,-8246708.73036414,1867434.26823634,-10238026.7189003,-20017398.5055666,-82204.8472031951,-18422501.6996542,10359854.737694,-20299889.8879462,-5695415.79024148,10277023.8260835,-3498750.10293657,-8944424.75334793,12810922.3884632,5583370.14144635,1404522.30584365,3268847.3118124,13145069.5643299,-5592808.86163241,12357325.1244472,8633775.29554844,-236681.493226588,5356913.73914742,10496634.5888309,5498004.33192527,5198600.59470284,-11888618.1073286,-7465334.07292962,-3344867.49896747,7716334.32341903,10201209.6983116,-6785928.9352631,-11551113.2533076,15902265.9553945,-9262724.69080794,16818663.5200903,1928609.56820846],"marker":{"color":"rgb(227, 119, 194)","line":{"color":"rgba(227,119,194,1)"}},"name":"Residauls Dist.","type":"histogram","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x3","yaxis":"y3","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"title":"Index","anchor":"y","range":["2008-01-01","2014-01-01"]},"xaxis2":{"domain":[0,0.46],"automargin":true,"title":"Lag","anchor":"y4"},"xaxis3":{"domain":[0.54,1],"automargin":true,"title":"Residuals Distribution","anchor":"y3"},"yaxis3":{"domain":[0,0.36],"automargin":true,"title":"Count","anchor":"x3"},"yaxis4":{"domain":[0,0.36],"automargin":true,"title":"ACF","anchor":"x2"},"yaxis":{"domain":[0.44,0.7088],"automargin":true,"title":"Residuals","anchor":"x"},"yaxis2":{"domain":[0.7312,1],"automargin":true,"title":"Fitted vs. Actuals","anchor":"x"},"annotations":[],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"hovermode":"closest","showlegend":false,"title":"Residuals Analysis"},"attrs":{"4b5762de323e":{"x":{},"y":{},"mode":"lines","name":"Actual","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"4b5762de323e.1":{"x":{},"y":{},"mode":"lines","name":"Fitted","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","line":{"dash":"dash","color":"red"},"inherit":true},"4b5769b4b727":{"x":{},"y":{},"mode":"lines","line":{"color":"green"},"name":"Residuals","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"4b57576497a8":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"bar","width":0.01,"showlegend":false,"marker":{"color":"#00526d","line":{"color":"#00526d"}},"name":"Autocorrelation","inherit":true},"4b57576497a8.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","line":{"dash":"dash","color":"red","width":1},"showlegend":false,"name":"CI Upper","inherit":true},"4b57576497a8.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","line":{"dash":"dash","color":"red","width":1},"showlegend":false,"name":"CI Lower","inherit":true},"4b57d20c36b":{"x":[7288403.25834382,6437991.58693361,566675.020014167,9867409.77597088,7127365.3387385,6167036.01966399,3764474.8712188,4441477.44289851,2299197.79583454,537530.562128127,-769472.396472037,13006298.3325353,618217.899779558,-2597101.14770216,8180940.8315447,-3275208.27808815,-14891071.3238308,35121.8511016369,-10248583.6922902,26464075.8885044,-15531808.6863327,-385419.12687844,-7642909.03865576,-7282958.41847754,-17669435.4109264,596923.25841403,7551222.63442731,13501217.1948386,-13015493.0554537,7611942.99220908,-9447142.10580671,-7688325.48569763,3262442.21857136,-6523324.30967295,-15404166.5708569,-4205529.06084383,-8246708.73036414,1867434.26823634,-10238026.7189003,-20017398.5055666,-82204.8472031951,-18422501.6996542,10359854.737694,-20299889.8879462,-5695415.79024148,10277023.8260835,-3498750.10293657,-8944424.75334793,12810922.3884632,5583370.14144635,1404522.30584365,3268847.3118124,13145069.5643299,-5592808.86163241,12357325.1244472,8633775.29554844,-236681.493226588,5356913.73914742,10496634.5888309,5498004.33192527,5198600.59470284,-11888618.1073286,-7465334.07292962,-3344867.49896747,7716334.32341903,10201209.6983116,-6785928.9352631,-11551113.2533076,15902265.9553945,-9262724.69080794,16818663.5200903,1928609.56820846],"marker":{"color":"rgb(227, 119, 194)"},"name":"Residauls Dist.","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"histogram"}},"source":"A","config":{"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,".hideLegend":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>The <code>forecastLM</code> package allows us to account for transform, use a stepwise approach, and add in unique events or outliers. Although I dont show it here, there is also an option to take spline regression approach.</p>
<pre class="r"><code>events &lt;- list(outlier = c(as_date(&quot;2009-01-01&quot;), as_date(&quot;2009-09-01&quot;), as_date(&quot;2010-05-01&quot;), as_date(&quot;2010-12-01&quot;), as_date(&quot;2014-12-01&quot;), as_date(&quot;2011-09-01&quot;)))
lm3  &lt;- trainLM(input = seasonal,
               y = &quot;avg&quot;,
               trend = list(log = TRUE),
               seasonal = &quot;month&quot;, 
               lags = c(1),
               step = TRUE,
               events = events)</code></pre>
<pre><code>## Start:  AIC=2305.78
## seasonal ~ outlier + month + log_trend + lag_1
## 
##             Df  Sum of Sq        RSS    AIC
## &lt;none&gt;                    5.9128e+15 2305.8
## - lag_1      1 1.8686e+14 6.0997e+15 2306.0
## - outlier    1 2.2630e+14 6.1391e+15 2306.4
## - log_trend  1 2.6752e+15 8.5880e+15 2330.3
## - month     11 2.8860e+16 3.4773e+16 2409.6</code></pre>
<pre class="r"><code>summary(lm3$model)</code></pre>
<pre><code>## 
## Call:
## stats::lm(formula = seasonal ~ outlier + month + log_trend + 
##     lag_1, data = df1)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -23297398  -6996325   1617514   6189965  23003813 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.284e+08  4.814e+07   6.821 6.82e-09 ***
## outlier      7.745e+06  5.290e+06   1.464 0.148788    
## monthFeb    -1.936e+07  7.494e+06  -2.584 0.012416 *  
## monthMar     3.080e+07  6.724e+06   4.580 2.64e-05 ***
## monthApr     1.921e+07  1.055e+07   1.821 0.073998 .  
## monthMay     3.520e+07  1.010e+07   3.486 0.000962 ***
## monthJun     3.882e+07  1.195e+07   3.247 0.001971 ** 
## monthJul     3.013e+07  1.253e+07   2.405 0.019524 *  
## monthAug     1.905e+07  1.166e+07   1.634 0.107799    
## monthSep    -7.180e+06  1.023e+07  -0.702 0.485840    
## monthOct    -5.984e+06  7.940e+06  -0.754 0.454228    
## monthNov    -3.288e+07  7.501e+06  -4.383 5.21e-05 ***
## monthDec    -3.056e+07  6.238e+06  -4.899 8.60e-06 ***
## log_trend   -1.459e+07  2.899e+06  -5.034 5.31e-06 ***
## lag_1        1.733e-01  1.303e-01   1.330 0.188805    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 10280000 on 56 degrees of freedom
## Multiple R-squared:  0.9274, Adjusted R-squared:  0.9093 
## F-statistic: 51.11 on 14 and 56 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>plot_res(lm3)</code></pre>
<div id="htmlwidget-2" style="width:100%;height:100%;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"data":[{"x":["2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01"],"y":[374165152,355687578,399855819,388639443,411307544,415161326,405393784,389391266,362587470,353803777,322733711,318741733,361377478,339472713,380133298,384396702,391469434,381247341,382672919,362521445,370369895,333286901,309688888,302237874,330304432,305543380,366733254,374018118,399504457,380521275,384726834,358726926,329671455,333230020,298251207,285382073,322480722,307076591,363234183,349781343,352623620,372541998,350751002,361924350,312845217,313380880,303152329,293640890,315214803,320430694,366122047,357106000,373071360,387306474,363222892,362799587,336789908,321542825,295672895,299861553,326450615,311283986,340319408,334351807,353589770,370101067,367999200,339968116,303711377,321371392,275715285,294248188],"mode":"lines","name":"Actual","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y2","frame":null},{"x":["2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01"],"y":[363765917.4862,404808044.211945,396675058.461725,407461495.597424,412351197.39913,402077801.290392,387365251.198428,356640040.395906,351654708.333755,321850546.83041,317515815.215307,353957212.345384,333158235.399188,378515783.811335,373030754.892161,388870810.296072,392884288.03654,381632045.719829,370058970.437405,347366081.858067,341499289.067001,307533382.106743,305142005.363802,333811632.434309,318741708.415582,364060300.204637,362543680.309034,387024474.315295,386823424.242698,374363479.698653,363557293.899341,332369241.896734,328095424.834168,301397650.140011,304988736.819789,325170716.273351,311849049.05986,358960693.422062,356733285.910378,370027678.721324,373790463.803046,368206606.271147,353023453.623252,336142614.661466,320769292.019483,293656855.364904,293895968.670816,322503326.094844,306585817.548134,357360631.473328,353405679.8854,367551249.468263,373666912.796735,367173839.37911,351665949.50728,325100622.618964,321536405.677406,291753453.387096,289344133.141513,320385162.852112,305394214.091035,352692555.876693,345904953.541303,360630476.601622,367363194.721851,361312858.640869,349660771.334293,318356720.568864,313060675.068188,289022427.170836,283225651.788773],"mode":"lines","name":"Fitted","type":"scatter","line":{"color":"red","dash":"dash"},"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y2","frame":null},{"x":["2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01"],"y":[-8078339.48620039,-4952225.21194535,-8035615.46172458,3846048.40257561,2810128.60086966,3315982.70960772,2026014.80157161,5947429.60409397,2149068.66624546,883164.169589639,1225917.78469282,7420265.65461564,6314477.60081238,1617514.18866485,11365947.1078385,2598623.70392776,-11636947.0365397,1040873.28017128,-7537525.43740481,23003813.1419334,-8212388.06700069,2155505.8932569,-2904131.36380231,-3507200.43430853,-13198328.4155824,2672953.79536319,11474437.690966,12479982.6847048,-6302149.24269783,10363354.301347,-4830367.8993414,-2697786.89673388,5134595.16583234,-3146443.14001131,-19606663.8197886,-2689994.27335054,-4772458.05985951,4273489.57793826,-6951942.91037786,-17404058.7213244,-1248465.80304563,-17455604.2711471,8900896.37674791,-23297397.6614656,-7388412.01948267,9495473.63509637,-255078.670815647,-7288523.0948444,13844876.4518661,8761415.52667201,3700320.11460048,5520110.53173745,13639561.203265,-3950947.37910986,11133637.4927197,11689285.3810358,6419.32259368896,3919441.61290377,10517419.858487,6065452.14788759,5889771.90896463,-12373147.8766931,-11553146.5413032,-7040706.60162163,2737872.27814877,6686341.35913074,-9692655.33429337,-14645343.5688636,8310716.93181181,-13307142.1708356,11022536.2112267],"mode":"lines","line":{"color":"green"},"name":"Residuals","type":"scatter","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36],"y":[1,-0.0142344654727976,0.133152424675175,0.0592668623981854,0.114091036196832,0.045812013030546,0.109234729825462,-0.00574276504407221,-0.00407966745177966,-0.179917425087823,0.0599738352141393,-0.229901927744206,-0.160141050674428,-0.0702779831706634,-0.192407780737338,-0.137888940572649,-0.011941516589758,-0.194629101955902,-0.00783576261097587,0.0199128330664221,-0.0381290597463609,-0.0757362020589503,0.0322305613610053,0.276426773563791,-0.181188548573387,-0.0314644173195937,0.057978381059327,-0.0851024694453114,0.113441327853284,-0.0561246478418152,-0.0394696509817878,-0.0149972236690165,-0.0524214199191134,0.120552442364763,-0.0787646690906253,-0.0126541881222446,-0.0719143569371062],"type":"bar","width":[0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01],"showlegend":false,"marker":{"color":"#00526d","line":{"color":"#00526d"}},"name":"Autocorrelation","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x2","yaxis":"y4","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36],"y":[0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268,0.232604930757268],"type":"scatter","mode":"lines","line":{"color":"red","dash":"dash","width":1},"showlegend":false,"name":"CI Upper","marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x2","yaxis":"y4","frame":null},{"x":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36],"y":[-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268,-0.232604930757268],"type":"scatter","mode":"lines","line":{"color":"red","dash":"dash","width":1},"showlegend":false,"name":"CI Lower","marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x2","yaxis":"y4","frame":null},{"x":[-8078339.48620039,-4952225.21194535,-8035615.46172458,3846048.40257561,2810128.60086966,3315982.70960772,2026014.80157161,5947429.60409397,2149068.66624546,883164.169589639,1225917.78469282,7420265.65461564,6314477.60081238,1617514.18866485,11365947.1078385,2598623.70392776,-11636947.0365397,1040873.28017128,-7537525.43740481,23003813.1419334,-8212388.06700069,2155505.8932569,-2904131.36380231,-3507200.43430853,-13198328.4155824,2672953.79536319,11474437.690966,12479982.6847048,-6302149.24269783,10363354.301347,-4830367.8993414,-2697786.89673388,5134595.16583234,-3146443.14001131,-19606663.8197886,-2689994.27335054,-4772458.05985951,4273489.57793826,-6951942.91037786,-17404058.7213244,-1248465.80304563,-17455604.2711471,8900896.37674791,-23297397.6614656,-7388412.01948267,9495473.63509637,-255078.670815647,-7288523.0948444,13844876.4518661,8761415.52667201,3700320.11460048,5520110.53173745,13639561.203265,-3950947.37910986,11133637.4927197,11689285.3810358,6419.32259368896,3919441.61290377,10517419.858487,6065452.14788759,5889771.90896463,-12373147.8766931,-11553146.5413032,-7040706.60162163,2737872.27814877,6686341.35913074,-9692655.33429337,-14645343.5688636,8310716.93181181,-13307142.1708356,11022536.2112267],"marker":{"color":"rgb(227, 119, 194)","line":{"color":"rgba(227,119,194,1)"}},"name":"Residauls Dist.","type":"histogram","error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x3","yaxis":"y3","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"title":"Index","anchor":"y","range":["2008-01-01","2013-12-01"]},"xaxis2":{"domain":[0,0.46],"automargin":true,"title":"Lag","anchor":"y4"},"xaxis3":{"domain":[0.54,1],"automargin":true,"title":"Residuals Distribution","anchor":"y3"},"yaxis3":{"domain":[0,0.36],"automargin":true,"title":"Count","anchor":"x3"},"yaxis4":{"domain":[0,0.36],"automargin":true,"title":"ACF","anchor":"x2"},"yaxis":{"domain":[0.44,0.7088],"automargin":true,"title":"Residuals","anchor":"x"},"yaxis2":{"domain":[0.7312,1],"automargin":true,"title":"Fitted vs. Actuals","anchor":"x"},"annotations":[],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"hovermode":"closest","showlegend":false,"title":"Residuals Analysis"},"attrs":{"4b571f357dae":{"x":{},"y":{},"mode":"lines","name":"Actual","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"4b571f357dae.1":{"x":{},"y":{},"mode":"lines","name":"Fitted","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","line":{"dash":"dash","color":"red"},"inherit":true},"4b5770ce3a83":{"x":{},"y":{},"mode":"lines","line":{"color":"green"},"name":"Residuals","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"4b577363a850":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"bar","width":0.01,"showlegend":false,"marker":{"color":"#00526d","line":{"color":"#00526d"}},"name":"Autocorrelation","inherit":true},"4b577363a850.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","line":{"dash":"dash","color":"red","width":1},"showlegend":false,"name":"CI Upper","inherit":true},"4b577363a850.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","line":{"dash":"dash","color":"red","width":1},"showlegend":false,"name":"CI Lower","inherit":true},"4b5713bf575f":{"x":[-8078339.48620039,-4952225.21194535,-8035615.46172458,3846048.40257561,2810128.60086966,3315982.70960772,2026014.80157161,5947429.60409397,2149068.66624546,883164.169589639,1225917.78469282,7420265.65461564,6314477.60081238,1617514.18866485,11365947.1078385,2598623.70392776,-11636947.0365397,1040873.28017128,-7537525.43740481,23003813.1419334,-8212388.06700069,2155505.8932569,-2904131.36380231,-3507200.43430853,-13198328.4155824,2672953.79536319,11474437.690966,12479982.6847048,-6302149.24269783,10363354.301347,-4830367.8993414,-2697786.89673388,5134595.16583234,-3146443.14001131,-19606663.8197886,-2689994.27335054,-4772458.05985951,4273489.57793826,-6951942.91037786,-17404058.7213244,-1248465.80304563,-17455604.2711471,8900896.37674791,-23297397.6614656,-7388412.01948267,9495473.63509637,-255078.670815647,-7288523.0948444,13844876.4518661,8761415.52667201,3700320.11460048,5520110.53173745,13639561.203265,-3950947.37910986,11133637.4927197,11689285.3810358,6419.32259368896,3919441.61290377,10517419.858487,6065452.14788759,5889771.90896463,-12373147.8766931,-11553146.5413032,-7040706.60162163,2737872.27814877,6686341.35913074,-9692655.33429337,-14645343.5688636,8310716.93181181,-13307142.1708356,11022536.2112267],"marker":{"color":"rgb(227, 119, 194)"},"name":"Residauls Dist.","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"histogram"}},"source":"A","config":{"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"subplot":true,".hideLegend":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Now that we have a prediction model that accounts for roughly 90% of the variability, we can look and see what this may have looked like with somewhat clean data or consistent reporting.</p>
<pre class="r"><code># Using the lm3 prediction model. 
fc3 &lt;- forecastLM(lm3, h = 24)</code></pre>
<pre class="r"><code># Plot it.
plot_fc(fc3, theme = &#39;classic&#39;)</code></pre>
<div id="htmlwidget-4" style="width:100%;height:100%;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"visdat":{"4b576fb9bb47":["function () ","plotlyVisDat"]},"cur_data":"4b576fb9bb47","attrs":{"4b576fb9bb47":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","line":{"color":"black"},"name":"Actual","inherit":true},"4b576fb9bb47.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":["2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01"],"ymin":[293875601.296131,278569046.693837,325870006.46262,322304609.615533,337447171.04088,343579033.508645,335768123.60222,323169428.644557,294332936.04669,290646562.811518,262910922.09102,266256556.026902,290961395.879385,275793570.555022,323161328.222369,319637656.195905,334818655.401565,340982802.412273,333204283.065792,320637373.756607,291836670.577742,288176694.588504,260469417.352476,257786975.371839],"ymax":[339708835.178664,323709091.433137,370911412.417555,367287779.573932,382489667.678017,388483178.578857,380639360.715007,368014873.15922,339650649.944462,335460201.579946,307694263.924568,314508371.277243,336842202.16644,321097461.61301,368355552.721429,364764442.213733,379992482.399023,386015387.252771,378199158.90401,365601419.462214,337258577.94642,333097593.457794,305357888.988845,302764193.824354],"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","line":{"color":"rgba( 168,172,198 0.6 )"},"fillcolor":"rgba( 168,172,198 0.6 )","name":"95% PI","inherit":true},"4b576fb9bb47.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":["2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01"],"ymin":[301956519.438258,286527747.740443,333811316.374572,330235651.86184,345388673.252454,351496142.772298,343679430.820335,331076188.335551,302322962.177834,298547714.789287,270806732.376092,274763897.451825,299050701.575132,283781159.562984,331129581.774144,327594019.579776,342783312.642829,348922557.06186,341137389.191267,328565044.180586,299845067.197677,296096757.736652,268383763.21226,265716968.300264],"ymax":[331627917.036537,315750390.386531,362970102.505603,359356737.327625,374548165.466442,380566069.315204,372728053.496892,360108113.468226,331660623.813319,327559049.602177,299798453.639496,306001029.85232,328752896.470693,313109872.605048,360387299.169654,356808078.829862,372027825.157758,378075632.603184,370266052.778535,357673749.038235,329250181.326485,325177530.309645,297443543.129062,294834200.895928],"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","line":{"color":"rgba( 168,172,198 0.8 )"},"fillcolor":"rgba( 168,172,198 0.8 )","name":"80% PI","inherit":true},"4b576fb9bb47.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":["2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01"],"y":[316792218.237397,301139069.063487,348390709.440088,344796194.594732,359968419.359448,366031106.043751,358203742.158613,345592150.901888,316991792.995576,313053382.195732,285302593.007794,290382463.652073,313901799.022913,298445516.084016,345758440.471899,342201049.204819,357405568.900294,363499094.832522,355701720.984901,343119396.609411,314547624.262081,310637144.023149,282913653.170661,280275584.598096],"type":"scatter","mode":"lines","name":"Forecast","line":{"color":"blue","dash":null},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"seasonal Forecast <br>Horizon -  24","paper_bgcolor":"white","plot_bgcolor":"white","font":{"color":"black"},"yaxis":{"domain":[0,1],"automargin":true,"title":"seasonal","linecolor":"black","zerolinecolor":"black","gridcolor":[]},"xaxis":{"domain":[0,1],"automargin":true,"title":"index","linecolor":"black","zerolinecolor":"black","gridcolor":[]},"hovermode":"closest","showlegend":true},"source":"A","config":{"showSendToCloud":false},"data":[{"x":["2008-01-01","2008-02-01","2008-03-01","2008-04-01","2008-05-01","2008-06-01","2008-07-01","2008-08-01","2008-09-01","2008-10-01","2008-11-01","2008-12-01","2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01"],"y":[374165152,355687578,399855819,388639443,411307544,415161326,405393784,389391266,362587470,353803777,322733711,318741733,361377478,339472713,380133298,384396702,391469434,381247341,382672919,362521445,370369895,333286901,309688888,302237874,330304432,305543380,366733254,374018118,399504457,380521275,384726834,358726926,329671455,333230020,298251207,285382073,322480722,307076591,363234183,349781343,352623620,372541998,350751002,361924350,312845217,313380880,303152329,293640890,315214803,320430694,366122047,357106000,373071360,387306474,363222892,362799587,336789908,321542825,295672895,299861553,326450615,311283986,340319408,334351807,353589770,370101067,367999200,339968116,303711377,321371392,275715285,294248188],"type":"scatter","mode":"lines","line":{"color":"black"},"name":"Actual","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba( 168,172,198 0.6 )","x":["2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2015-12-01","2015-12-01","2015-11-01","2015-10-01","2015-09-01","2015-08-01","2015-07-01","2015-06-01","2015-05-01","2015-04-01","2015-03-01","2015-02-01","2015-01-01","2014-12-01","2014-11-01","2014-10-01","2014-09-01","2014-08-01","2014-07-01","2014-06-01","2014-05-01","2014-04-01","2014-03-01","2014-02-01","2014-01-01"],"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","line":{"color":"rgba( 168,172,198 0.6 )"},"name":"95% PI","y":[293875601.296131,278569046.693837,325870006.46262,322304609.615533,337447171.04088,343579033.508645,335768123.60222,323169428.644557,294332936.04669,290646562.811518,262910922.09102,266256556.026902,290961395.879385,275793570.555022,323161328.222369,319637656.195905,334818655.401565,340982802.412273,333204283.065792,320637373.756607,291836670.577742,288176694.588504,260469417.352476,257786975.371839,257786975.371839,302764193.824354,305357888.988845,333097593.457794,337258577.94642,365601419.462214,378199158.90401,386015387.252771,379992482.399023,364764442.213733,368355552.721429,321097461.61301,336842202.16644,314508371.277243,307694263.924568,335460201.579946,339650649.944462,368014873.15922,380639360.715007,388483178.578857,382489667.678017,367287779.573932,370911412.417555,323709091.433137,339708835.178664],"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba( 168,172,198 0.8 )","x":["2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2015-12-01","2015-12-01","2015-11-01","2015-10-01","2015-09-01","2015-08-01","2015-07-01","2015-06-01","2015-05-01","2015-04-01","2015-03-01","2015-02-01","2015-01-01","2014-12-01","2014-11-01","2014-10-01","2014-09-01","2014-08-01","2014-07-01","2014-06-01","2014-05-01","2014-04-01","2014-03-01","2014-02-01","2014-01-01"],"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","line":{"color":"rgba( 168,172,198 0.8 )"},"name":"80% PI","y":[301956519.438258,286527747.740443,333811316.374572,330235651.86184,345388673.252454,351496142.772298,343679430.820335,331076188.335551,302322962.177834,298547714.789287,270806732.376092,274763897.451825,299050701.575132,283781159.562984,331129581.774144,327594019.579776,342783312.642829,348922557.06186,341137389.191267,328565044.180586,299845067.197677,296096757.736652,268383763.21226,265716968.300264,265716968.300264,294834200.895928,297443543.129062,325177530.309645,329250181.326485,357673749.038235,370266052.778535,378075632.603184,372027825.157758,356808078.829862,360387299.169654,313109872.605048,328752896.470693,306001029.85232,299798453.639496,327559049.602177,331660623.813319,360108113.468226,372728053.496892,380566069.315204,374548165.466442,359356737.327625,362970102.505603,315750390.386531,331627917.036537],"marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01"],"y":[316792218.237397,301139069.063487,348390709.440088,344796194.594732,359968419.359448,366031106.043751,358203742.158613,345592150.901888,316991792.995576,313053382.195732,285302593.007794,290382463.652073,313901799.022913,298445516.084016,345758440.471899,342201049.204819,357405568.900294,363499094.832522,355701720.984901,343119396.609411,314547624.262081,310637144.023149,282913653.170661,280275584.598096],"type":"scatter","mode":"lines","name":"Forecast","line":{"color":"blue","dash":[]},"marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Again, this was just a venture into using these two packages, not a full EDA or true statistical analysis. In all honesty, I do not often inspect seasonality or such trends in my own work, so I’m still learning.</p>
<p>Cheers.</p>
